![Python](https://img.shields.io/badge/python-white?style=for-the-badge&logo=python&labelColor=white&color=blue)   ![FastAPI](https://img.shields.io/badge/FastAPI-white?style=for-the-badge&logo=fastapi&labelColor=white&color=009688)
# Tenders Parser
## Установка (Python 3.13)

#### 1. Клонировать репозиторий
``
git clone https://github.com/knn-work/test_tender_parser.git
``
#### 2. Перейти в папку проекта
``
cd .\test_tender_parser\
``

#### 3. Создать виртуальное окружение
``
python -m venv env
``

Или если python 3.13 не в path то указать ссылку до него, например так:

``
 & 'C:\Program Files\Python313\python.exe' -m venv env
``
#### 4. Активировать интерпретатор (пример для windows)
``
.\env\Scripts\activate
``
#### 5. Установить poetry
``
python -m pip install poetry
``
#### 6. Установить зависимости
``
poetry install --no-root
``
#### 7. Клонировать .env (и изменит если что то нужно, например - количество загружаемых тендеров)
``
cp .env.example .env
``
# Запуск

### Cli
``
python .\cli.py --get-new --max 10 --output output.csv
``
#### --get-new - загрустить `COUNT_TENDER` первых записей (Необязательный, если не указывать то выгрузит все что есть сохраненного в бд).
#### --max `Count` - взять только `Count` записей (Необязательный, если не указывать то выгрузит все что есть).
#### --output `output.csv` загрузить выход программы в `output.csv` (Необязательный, если не указывать напечатает в консоль).

#### Получить документацию
``
python .\cli.py --help
``
### FastAPI
``
python .\main.py
``

#### http://127.0.0.1:80/docs - Документация с эндпоинтами.


## Что Использовалось:
## Cli
Для реализации консольного приложения использовал argparse, и сделал свою реализацию паттерна **_Command_**.
Что облегчает добавление новых комант, необходимо лишь расширить список _commands_ своей командой унаследованной от абстрактного класса Command, и реализовать execute(поведение при вызове) и default(поведение по умолчанию).

## Парсинг
Для парсинга было реализованно несколько хитростей, позволяющих проходить проверку сайта и не получать 403.
1. time.sleep(random.uniform(1.2, 3.4)) - Случайные интервалы между запросами
2.  UserAgent().random из библиотеки fake_useragent, чтобы подменять заголовки питона на случайные.

## Веб
Для веб приложения использовался FasAPI, в котором был реализованы эндпоинты.

## Архитектура
За шаблон была взят вариант луковичной архитектуры для FastAPI приложения, с серврисами, репозиториями и схемами.

## Бд
В качестве бд использовалась SQLite, взаимодействие с ней было через SQLAlchemy.

## Что можно улучшить:
1. Использовать логирование, а не принты.
2. Обернуть в докер контейнер или Makefile.
3. Изменить логику парсинга, парсить только то чего уже нет в бд, сейчас же парсется все `COUNT_TENDER` и вставляются в бд отсутствующие.
4. Написать тесты.
5. Сделать интерфейс для TenderParser,  чтобы безболезненно его заменить если будет необходимо на парсер для другого сайта
